import json

import pandas as pd

from utils import pheniqs

configfile: "config.yaml"

DATA = dict()

DATA["multiplex_units"] = (
    config["data"]["dir"] + 
    config["data"]["multiplex_units"]) 
DATA["multiplex_samples"] = (
    config["data"]["dir"] + 
    config["data"]["multiplex_samples"])

units = pd.read_csv(DATA["multiplex_units"], index_col="id")

rule end:
    input:
        expand(
            "{unit}_demux.{variant}.json",
            unit=units.index.values,
            variant=["config", "report"]
        ),
        expand(
            config["data"]["dir"] + "{unit}_inter.cram",
            unit=units.index.values,
        ),
        expand(
            "{unit}{variant}.cram",
            unit=units.index.values,
            variant=[
                "_demux"
                ]
        )

include: "rules/pheniqs_interleave.smk"
include: "rules/pheniqs_demultiplex_config.smk"
include: "rules/pheniqs_demultiplex.smk"
